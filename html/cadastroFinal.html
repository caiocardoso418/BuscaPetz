<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Criar AnÃºncio Pet - Finalizar</title>
  <link rel="stylesheet" href="../css/cadastroFinal.css">
</head>
<body>
  <div class="container">
    <div class="titulo">
      <h1>Criar Anuncio Pet</h1>
    </div>
    <div class="form-box">
      <h2>Cadastro</h2>
      <form onsubmit="finalizarCadastro(event)">
        <label for="data">Data do desaparecimento</label>
        <div class="input-icon">
          <span class="icon">ðŸ“…</span>
          <input type="date" id="data" name="data" required>
        </div>

        <label for="telefone">Telefone pra contato</label>
        <input type="tel" id="telefone" name="telefone" placeholder="Insira seu nÃºmero" required>

        <button type="submit">Finalizar</button>
      </form>
    </div>
  </div>

    <script>
    async function finalizarCadastro(event) {
        event.preventDefault();

        const data = document.getElementById("data").value;
        const telefone = document.getElementById("telefone").value;

        // Salvar em localStorage
        localStorage.setItem("data_desaparecimento", data);
        localStorage.setItem("telefone", telefone);

        // Montar objeto com todos os dados salvos
        const anuncio = {
        nome: localStorage.getItem("nome"),
        descricao: localStorage.getItem("descricao"),
        especie: localStorage.getItem("especie"),
        genero: localStorage.getItem("genero"),
        raca: localStorage.getItem("raca"),
        porte: localStorage.getItem("porte"),
        cor: localStorage.getItem("cor"),
        endereco: localStorage.getItem("endereco"),
        data_desaparecimento: localStorage.getItem("data_desaparecimento"),
        telefone: localStorage.getItem("telefone"),
        id_usuario: localStorage.getItem("id_usuario")  // deve estar salvo no login
        };

        try {
        const response = await fetch("http://127.0.0.1:5000/anunciar", {
            method: "POST",
            headers: {
            "Content-Type": "application/json"
            },
            body: JSON.stringify(anuncio)
        });

        const result = await response.json();

        if (response.ok) {
            alert("PublicaÃ§Ã£o criada com sucesso!");
            localStorage.removeItem("especie");
            localStorage.removeItem("genero");
            localStorage.removeItem("raca");
            localStorage.removeItem("porte");
            localStorage.removeItem("cor");
            localStorage.removeItem("nome");
            localStorage.removeItem("descricao");
            localStorage.removeItem("endereco");
            localStorage.removeItem("data_desaparecimento");
            localStorage.removeItem("telefone");

            window.location.href = "home.html";
        } else {
            alert("Erro ao cadastrar: " + result.erro);
        }
        } catch (error) {
        alert("Erro de conexÃ£o com o servidor.");
        console.error(error);
        }
    }
    </script>

</body>
</html>
